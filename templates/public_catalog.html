<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Public Catalog</title>
    <link rel="stylesheet" href="{{ url_for('static',filename='styles/style.css') }}">
    <script src="https://kit.fontawesome.com/b99e675b6e.js"></script>
</head>
<body>
    <div class="ahs-logo">
        <form method="post" action="/">
            <input type="image" src="{{url_for('static', filename= 'styles/images/ahsLogo.png')}}" width="100" height="100" alt="logo" />
        </form>
    </div>
    <div class="page-container">
        <div class="wrapper">

            <div class="topnav">
                <p>Abington Senior High School</p>
                <form method="post" action="/catalog">
                    <input type="submit" value="Logout" style="position:absolute;right:0px; top:0px;" border:none; z-index:9999; margin-bottom:15px;" name="logoutBtn" />
                </form>
            </div>

            <div class="header">
                <p>Course Catalog</p>
            </div>
            <div class="container">
                <div class="mainArea">
                    <div class="mainSpace">

                        <form method="post" action="/catalog" id="search">

                            <div class="search_box">

                                <input type="text" class="input" placeholder="Search..." name="searchBar" id="searchBar">

                                <div class="btn">
                                    <button name="searchButton" type="submit" class="fas fa-search" id="searchButton"></button>
                                    <!--https://fontawesome.com/v4.7/icon/search-->
                                </div>
                            </div>

                        </form>

                        <template id="cont">
                            <!-- what exactly is the point of having multiple tables?-->
                            <table>


                                <tr>
                                    <td>
                                        <div style="display: flex; justify-content: space-between;">
                                            <div class="course-name" id="course-name" data-unique-id="##uniqueId##">##course name##</div>
                                        </div>
                                        <div class="descriptions">
                                            <!--<div>##pathway##</div>-->
                                            <!--maybe we should display pathway within the dropdown or something-->

                                            <div>##depts##</div>
                                            <div>##courseLength##</div>
                                            <div>##courseLevel##</div>
                                            <div>##credits##</div>

                                            <div>
                                                <button class="viewDescriptionBtn" id="##buttonID##" onclick="descriptionBttn(this)">
                                                    View Description
                                                    <i class="fa fa-caret-down" style="margin-left:5px;"></i>
                                                </button>
                                            </div>
                                        </div>
                                        <div class="descriptions" id="##descID##" style="display: none;">##description##</div>
                                    </td>
                                </tr>


                            </table>

                        </template>

                        <!--need a better way to render null return-->

                        <div id="changePageBar" style="margin-top: 10%;">
                            <button type="submit" class="changePageBttn" id="chngPgBtn-Back" style="color: #ffffff; width: 20px; height: 25px; background: rgb(150, 38, 38); border: none; cursor: pointer;"><i class="fa fa-caret-left" style="margin-left:5px;"></i></button>
                            <button type="submit" class="changePageBttn" id="chngPgBtn-Forward" style="color: #ffffff; width: 20px; height: 25px; background: rgb(150, 38, 38); border: none; cursor: pointer;"><i class="fa fa-caret-down" style="margin-left:5px;"></i></button>
                        </div>

                        <div class="results" id="results">

                        </div>

                    </div>

                    <div class="sidebar">
                        <p>Filter by Category</p>

                        <button class="dropdown" id="pathwayBttn">
                            Pathway
                            <i class="fa fa-caret-down"></i>
                        </button>

                        <form action="/catalog" id="pathways">

                            <div class="dropdown-container" id="pathwayDDs">

                                <label for="business" class="checkbox-container">
                                    Business
                                    <input type="checkbox" id="business" value="bisPath">
                                    <span class="checkmark"></span>
                                </label>

                                <label for="compSci" class="checkbox-container">
                                    Computer Science
                                    <input type="checkbox" id="compSci" value="csPath">
                                    <span class="checkmark"></span>
                                </label>

                                <label for="government" class="checkbox-container">
                                    Government
                                    <input type="checkbox" id="government" value="govPath">
                                    <span class="checkmark"></span>
                                </label>

                                <label for="health" class="checkbox-container">
                                    Health Services
                                    <input type="checkbox" id="health" value="healthPath">
                                    <span class="checkmark"></span>
                                </label>

                                <label for="humanities" class="checkbox-container">
                                    Humanities
                                    <input type="checkbox" id="humanities" value="humPath">
                                    <span class="checkmark"></span>
                                </label>

                                <label for="manu" class="checkbox-container">
                                    Manufacturing
                                    <input type="checkbox" id="manu" value="manuPath">
                                    <span class="checkmark"></span>
                                </label>

                                <label for="stem" class="checkbox-container">
                                    STEM
                                    <input type="checkbox" id="stem" value="stemPath">
                                    <span class="checkmark"></span>
                                </label>

                                <label for="scoSci" class="checkbox-container">
                                    Social Science
                                    <input type="checkbox" id="scoSci" value="socSciPath">
                                    <span class="checkmark"></span>
                                </label>

                                <label for="arts" class="checkbox-container">
                                    Arts
                                    <input type="checkbox" id="arts" value="visPath">
                                    <span class="checkmark"></span>
                                </label>

                            </div>
                        </form>

                        <button class="dropdown">
                            Department
                            <i class="fa fa-caret-down"></i>
                        </button>

                        <form action="/catalog" id="departments">
                            <div class="dropdown-container">

                                <label for="AR" class="checkbox-container">
                                    Art
                                    <input type="checkbox" id="AR" value="AR">
                                    <span class="checkmark"></span>
                                </label>

                                <label for="TE" class="checkbox-container">
                                    Technology
                                    <input type="checkbox" id="TE" value="TE">
                                    <span class="checkmark"></span>
                                </label>

                                <label for="BU" class="checkbox-container">
                                    Business
                                    <input type="checkbox" id="BU" value="BU">
                                    <span class="checkmark"></span>
                                </label>

                                <label for="EN" class="checkbox-container">
                                    English
                                    <input type="checkbox" id="EN" value="EN">
                                    <span class="checkmark"></span>
                                </label>

                                <label for="CS" class="checkbox-container">
                                    Consumer Science
                                    <input type="checkbox" id="CS" value="CS">
                                    <span class="checkmark"></span>
                                </label>

                                <label for="HP" class="checkbox-container">
                                    Health & PE
                                    <input type="checkbox" id="HP" value="HP">
                                    <span class="checkmark"></span>
                                </label>

                                <label for="RD" class="checkbox-container">
                                    Reading
                                    <input type="checkbox" id="RD" value="RD">
                                    <span class="checkmark"></span>
                                </label>

                                <label for="SC" class="checkbox-container">
                                    Science
                                    <input type="checkbox" id="SC" value="SC">
                                    <span class="checkmark"></span>
                                </label>

                                <label for="FL" class="checkbox-container">
                                    Foreign Language
                                    <input type="checkbox" id="FL" value="FL">
                                    <span class="checkmark"></span>
                                </label>

                                <label for="MA" class="checkbox-container">
                                    Mathmatics
                                    <input type="checkbox" id="MA" value="MA">
                                    <span class="checkmark"></span>
                                </label>

                                <label for="SS" class="checkbox-container">
                                    Social Studies
                                    <input type="checkbox" id="SS" value="SS">
                                    <span class="checkmark"></span>
                                </label>

                                <label for="MU" class="checkbox-container">
                                    Music
                                    <input type="checkbox" id="MU" value="MU">
                                    <span class="checkmark"></span>
                                </label>

                                <label for="N/A" class="checkbox-container">
                                    N/A
                                    <input type="checkbox" id="N/A" value="N/A">
                                    <span class="checkmark"></span>
                                </label>

                            </div>
                        </form>


                        <button class="dropdown">
                            Course Level
                            <i class="fa fa-caret-down"></i>
                        </button>

                        <form action="/catalog" id="courseLevel">
                            <div class="dropdown-container">

                                <label for="ap" class="checkbox-container">
                                    AP
                                    <input type="checkbox" id="ap" value="3">
                                    <span class="checkmark"></span>
                                </label>

                                <label for="honors" class="checkbox-container">
                                    Honors
                                    <input type="checkbox" id="honors" value="2">
                                    <span class="checkmark"></span>
                                </label>

                                <label for="cp" class="checkbox-container">
                                    Standard/CP
                                    <input type="checkbox" id="cp" value="1">
                                    <span class="checkmark"></span>
                                </label>
                            </div>
                        </form>


                        <button class="dropdown">
                            Length
                            <i class="fa fa-caret-down"></i>
                        </button>

                        <form action="/catalog" id="courseLength">
                            <div class="dropdown-container">

                                <label for="semester" class="checkbox-container">
                                    Semester
                                    <input type="checkbox" id="semester" value="SM">
                                    <span class="checkmark"></span>
                                </label>

                                <label for="fullYear" class="checkbox-container">
                                    Full Year
                                    <input type="checkbox" id="fullYear" value="YR">
                                    <span class="checkmark"></span>
                                </label>

                            </div>
                        </form>
                    </div>

                </div>
            </div>
        </div>
    </div>

    <!--separate our js into separate file in order to maintain consistency?-->
    <script src="{{ url_for('static', filename='jquery-3.6.0.js') }}"></script>

    <script type="text/javascript">
        var n = 0;
        var currentData;
        var length;

        $.ajax({
            type: "POST",
            url: "/catalog",
            data: { "initialized": "1" }
        }).done(function (response) {
            currentData = response; n = 0;
            display(JSON.parse(currentData));
        });

        $("#chngPgBtn-Back").click(function () {
            if (n >= 10) { n -= 10; }
            display(JSON.parse(currentData));
        });

        $("#chngPgBtn-Forward").click(function () {
            if ((n + 10) < length) { n += 10; }
            display(JSON.parse(currentData));
        });

        $("#search").submit(function (event) {
            event.preventDefault();
            $.ajax({
                type: "POST",
                url: "/catalog",
                data: { "searchBar": document.getElementById("searchBar").value, "searchButton": "" }
            }).done(function (response) {
                currentData = response; n = 0;
                display(JSON.parse(response));
            });
        });

        $("#pathways").on("change", "input:checkbox", function (event) {
            event.preventDefault();
            AJAX("pathways");
        });

        $("#departments").on("change", "input:checkbox", function (event) {
            event.preventDefault();
            AJAX("departments");
        });

        $("#courseLevel").on("change", "input:checkbox", function (event) {
            event.preventDefault();
            AJAX("courseLevel");
        });

        $("#courseLength").on("change", "input:checkbox", function (event) {
            event.preventDefault();
            AJAX("courseLength");
        });

        function AJAX(elementID) {
            var checked = "";
            var checkboxes = document.getElementById(elementID).querySelectorAll('input[type=checkbox]:checked');
            for (var i = 0; i < checkboxes.length; i++) checked += checkboxes[i].value + "#";
            $.ajax({
                type: "POST",
                url: "/catalog",
                data: { "selected": checked, "origin": elementID, "searchBar": document.getElementById("searchBar").value }
            }).done(function (response) {
                currentData = response; n = 0;
                display(JSON.parse(response));
            });
        }

        function display(json) {
            $("#results").html("");
            //console.log(json);
            var subKeys = Object.keys(json['ID']);
            var temp = document.getElementById("cont");
            //alert(n);

            var start = n;
            var end = n + 10;
            length = subKeys.length;

            if (end > length) { end = length; }

            for (var s = start; s < end; s++) {
                var longDescription = json['longDescription'][subKeys[s]];
                var description = json['description'][subKeys[s]];
                var dept = json['dept'][subKeys[s]];
                var courseLength = json['Length'][subKeys[s]];

                var uniqueId = json['ID'][subKeys[s]];
                var credits = parseInt(json['credits'][subKeys[s]]);

                temp.innerHTML = temp.innerHTML.replace("##course name##", longDescription);

                temp.innerHTML = temp.innerHTML.replace("##description##", description);
                temp.innerHTML = temp.innerHTML.replace("##depts##", dept);
                temp.innerHTML = temp.innerHTML.replace("##courseLength##", courseLength);
                temp.innerHTML = temp.innerHTML.replace("##credits##", credits + " credits");
                temp.innerHTML = temp.innerHTML.replace("##uniqueId##", uniqueId);

                var levelNum = json['level'][subKeys[s]];
                var level;
                if (levelNum == "1") level = "Standard/CP";
                if (levelNum == "2") level = "Honors";
                if (levelNum == "3") level = "AP";

                temp.innerHTML = temp.innerHTML.replace("##courseLevel##", level);

                temp.innerHTML = temp.innerHTML.replace("##buttonID##", "button" + s);
                temp.innerHTML = temp.innerHTML.replace("##descID##", "desc" + s);


                document.getElementById("results").appendChild(temp.content.cloneNode(true));


                temp.innerHTML = temp.innerHTML.replace(longDescription, "##course name##");

                temp.innerHTML = temp.innerHTML.replace(description, "##description##");
                temp.innerHTML = temp.innerHTML.replace(dept, "##depts##");
                temp.innerHTML = temp.innerHTML.replace(courseLength, "##courseLength##");
                temp.innerHTML = temp.innerHTML.replace(level, "##courseLevel##");
                temp.innerHTML = temp.innerHTML.replace(credits + " credits", "##credits##");
               temp.innerHTML = temp.innerHTML.replace(uniqueId, "##uniqueId##");

                temp.innerHTML = temp.innerHTML.replace("button" + s, "##buttonID##");
                temp.innerHTML = temp.innerHTML.replace("desc" + s, "##descID##");
            }
        }

    </script>

    <script>

        //VARIABLES
        var theseContainers = document.getElementsByClassName("dropdown-container");
        var dropdownBttns = document.getElementsByClassName("dropdown");
        const dropdownmMap = new Map();
        var filterTypes = document.getElementsByClassName("filterType");

        //CLICKING ON DROPDOWNS
        var onButtonClick = function (event) {
            var thisBttn = event.currentTarget;
            var container = dropdownmMap.get(thisBttn);
            $(container).toggle();
        };

        //View Description Button
        var descriptionBttn = function (element) {
            var elementName = element.id;
            var elNum = elementName.substring(6);
            var descript = document.getElementById("desc" + elNum);
            $(descript).toggle();
        }

        //Add event listeners to all dropdowns
        for (var i = 0; i < dropdownBttns.length; i++) {
            dropdownmMap.set(dropdownBttns[i], theseContainers[i]);
            dropdownBttns[i].addEventListener("click", onButtonClick);
        }

    </script>

</body>
</html>
